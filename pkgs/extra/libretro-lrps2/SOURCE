src_unpack() {
    git clone https://github.com/libretro/LRPS2.git .
}

src_prepare() {
    git::checkout "$PKG_REF"
    fs::mkdir build
}

src_build() {
    cd build

    cmake .. -DLIBRETRO=ON -DCMAKE_BUILD_TYPE=Release
    make -j$(nproc)
}

src_install() {
    local base_dir="${XDG_CONFIG_HOME:-${HOME}/.config}/retroarch"
    fs::mkdir "${base_dir}/cores" "${base_dir}/system/pcsx2/"{bios,cheats,cheats_ws,memcards}

    install build/pcsx2/pcsx2_libretro.so "${base_dir}/cores"
}
