src_unpack() {
    git clone https://github.com/hrydgard/ppsspp.git .
}

src_prepare() {
    git::checkout "$PKG_REF"
    git submodule update --init --recursive
}

src_build() {
    ./b.sh --libretro
}

src_install() {
    local base_dir="${XDG_CONFIG_HOME:-${HOME}/.config}/retroarch"
    fs::mkdir "${base_dir}/cores" "${base_dir}/system/PPSSPP"

    cp -r assets/* "${base_dir}/system/PPSSPP"
    install build/lib/ppsspp_libretro.so "${base_dir}/cores"
}
